// --- 電卓ボタン群のイベント ---
const calcButtons = Array.from(document.querySelectorAll('#calcButtons button'));
calcButtons.forEach(button => {
    // 押下開始でフラグを立て、click合成を抑える（passive:false）
    button.addEventListener('pointerdown', (e) => {
        e.preventDefault();
        button._pressed = true;
    }, { passive: false });

    // 指を離したときにのみ発火（フラグ確認）
    button.addEventListener('pointerup', (e) => {
        if (!button._pressed) return; // pointerdown が無ければ無視
        button._pressed = false;
        e.preventDefault();
        const value = button.textContent.trim();
        if (value === 'C') {
            clearCalc();
            return;
        }
        if (value === '＋') {
            press('+');
            return;
        }
        press(value);
    });

    // キャンセルや離脱でフラグをクリア
    button.addEventListener('pointercancel', () => { button._pressed = false; });
    button.addEventListener('pointerleave', () => { button._pressed = false; });
});
